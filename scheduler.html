<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>LILAC Calendar</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
        // Apply theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const shouldBeDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
            if (shouldBeDark) {
                document.documentElement.classList.add('dark');
            }
        })();
</script>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
                        "primary": {
                            DEFAULT: "#137fec",
                            "50": "#e8f2fe",
                            "100": "#d1e6fd",
                            "200": "#a2cbfb",
                            "300": "#74b1f9",
                            "400": "#4596f7",
                            "500": "#137fec",
                            "600": "#0f66bc",
                            "700": "#0c4c8d",
                            "800": "#08335d",
                            "900": "#04192e"
                        },
                        "background-light": "#f1f5f9",
                        "background-dark": "#0f172a",
                        "card-light": "#ffffff",
                        "card-dark": "#1e293b",
                        "text-light": "#0f172a",
                        "text-dark": "#e2e8f0",
                        "text-muted-light": "#64748b",
                        "text-muted-dark": "#94a3b8",
                        "border-light": "#e2e8f0",
            "border-dark": "#334155",
          },
          fontFamily: {
                        "display": ["Inter", "sans-serif"]
          },
          borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
          },
                    boxShadow: {
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)',
                    }
        },
      },
        }
  </script>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-outlined.filled {
            font-variation-settings: 'FILL' 1;
        }
        .sidebar-collapsed .sidebar-text {
            display: none;
        }
        .sidebar-collapsed .sidebar-logo-text {
            display: none;
        }
        .sidebar-collapsed .sidebar {
            width: 5rem;
        }
        .sidebar-expanded .sidebar {
            width: 16rem;
        }
        .sidebar-collapsed .sidebar-profile-info {
            display: none;
        }
        .sidebar-collapsed .sidebar-profile-picture {
            display: none;
        }
        /* Add styles for expanded sidebar */
        .sidebar-expanded .sidebar-profile-picture {
            display: block;
        }
        .sidebar-expanded .sidebar-profile-info {
            display: block;
        }
        .sidebar-collapsed main {
            margin-left: 0;
        }
        .sidebar-expanded main {
            margin-left: 0 !important;  
        }
         .sidebar-expanded .main-content {
             padding-left: 0;
         }
         .sidebar-collapsed .main-content {
             padding-left: 0;
         }
        /* Restore navbar original offset without affecting main content */
        .sidebar-collapsed header {
            margin-left: 2rem;
        }
        .sidebar-expanded header {
            margin-left: 2rem !important;
        }
        .sidebar-collapsed .sidebar-toggle-icon-open {
            display: none;
        }
        .sidebar-collapsed .sidebar-toggle-icon-closed {
            display: block;
        }
        .sidebar-toggle-icon-closed {
            display: none;
        }
        .sidebar-collapsed .sidebar-nav-link {
            justify-content: center;
        }
        .sidebar-collapsed .sidebar-toggle-container {
            justify-content: center;
        }
        .sidebar-collapsed .profile-container {
            justify-content: center;
    }
        /* Draggable modal helpers */
        #createModal.dragging { align-items: flex-start; justify-content: flex-start; }
        #createModalHeader { cursor: move; }
        .dragging * { user-select: none; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
<div class="flex h-screen sidebar-collapsed" id="app-container">
<aside class="sidebar bg-card-light dark:bg-card-dark border-r border-border-light dark:border-border-dark flex flex-col">
<div class="flex items-center justify-start px-4 h-20 border-b border-border-light dark:border-border-dark">
<div class="flex items-center gap-3">
<img alt="CPU LILAC Logo" class="h-11 w-11" src="assets/images/cpu-logo.svg.png" width="32" height="32"/>
<h1 class="text-xl font-bold text-text-light dark:text-text-dark sidebar-logo-text hidden">LILAC</h1>
</div>
</div>
<nav class="flex-1 px-4 py-6 space-y-2">
<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-background-dark hover:text-text-light dark:hover:text-text-dark transition-colors duration-200 sidebar-nav-link" href="dashboard.html">
<span class="material-symbols-outlined">dashboard</span>
<span class="sidebar-text hidden">Dashboard</span>
</a>
<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-background-dark hover:text-text-light dark:hover:text-text-dark transition-colors duration-200 sidebar-nav-link" href="awards.html">
<span class="material-symbols-outlined">emoji_events</span>
<span class="sidebar-text hidden">Awards Progress</span>
</a>
<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-background-dark hover:text-text-light dark:hover:text-text-dark transition-colors duration-200 sidebar-nav-link" href="events-activities.html">
<span class="material-symbols-outlined">event</span>
<span class="sidebar-text hidden">Events &amp; Activities</span>
</a>
<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg bg-primary-50 dark:bg-primary-900/40 text-primary-600 dark:text-primary-400 font-semibold sidebar-nav-link" href="scheduler.html">
<span class="material-symbols-outlined filled">calendar_today</span>
<span class="sidebar-text hidden">Scheduler</span>
</a>
<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-background-dark hover:text-text-light dark:hover:text-text-dark transition-colors duration-200 sidebar-nav-link" href="mou-moa.html">
<span class="material-symbols-outlined">handshake</span>
<span class="sidebar-text hidden">MOUs &amp; MOAs</span>
</a>

<a class="flex items-center justify-center gap-3 px-4 py-2.5 rounded-lg text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-background-dark hover:text-text-light dark:hover:text-text-dark transition-colors duration-200 sidebar-nav-link" href="documents.html">
<span class="material-symbols-outlined">description</span>
<span class="sidebar-text hidden">Documents</span>
</a>
</nav>
<div class="px-4 py-4 border-t border-border-light dark:border-border-dark">
<div class="flex items-center justify-between profile-container">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-full bg-cover bg-center sidebar-profile-picture hidden" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC23fvgOSZIK6K5vguUgvVeU1XYFfp1LB3d4zICMvW6bispRl-eHHfnOtSsvRU3MgvmOpSYMCZhcSBIksvjlEHtkGMxuCFsQkuT0suo2-O9n3py7mlzFFETXCOIfvLVGGUj1aaG8ENOeDXXy_ifek2uG3R3--ghDflKvuAm9vrceoK8doav0lNYVbLz1bnWy6REWcrCPuPZZ8upfPqShoQpSDjICl16zMEcRuHzjt05z9cFITLKPdZTfMF-1dLK-klh8UhjeDeE4Q7p");'></div>
<div class="sidebar-profile-info hidden">
<p class="font-semibold text-text-light dark:text-text-dark">Admin User</p>
<a class="text-sm text-primary-600 dark:text-primary-400 hover:underline" href="profile.html">View Profile</a>
</div>
</div>
<button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-background-dark transition-colors" id="sidebar-toggle">
<span class="material-symbols-outlined sidebar-toggle-icon-open hidden">chevron_left</span>
<span class="material-symbols-outlined sidebar-toggle-icon-closed block">chevron_right</span>
</button>
</div>
</div>
</aside>
<main class="flex-1 overflow-y-auto">
<header class="sticky top-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm z-30 px-6 lg:px-8 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center h-20">
<h1 class="text-2xl font-bold text-text-light dark:text-text-dark">Calendar</h1>
<div class="flex items-center gap-2">
					<button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-white/10 text-text-muted-light dark:text-text-muted-dark transition-colors duration-200">
<span class="material-symbols-outlined">notifications</span>
</button>
<button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-white/10 text-text-muted-light dark:text-text-muted-dark transition-colors duration-200" id="theme-toggle">
<span class="material-symbols-outlined dark:hidden">light_mode</span>
<span class="material-symbols-outlined hidden dark:inline">dark_mode</span>
</button>
</div>
</header>
<div class="pl-2 lg:pl-1 pr-1 pb-6 lg:pb-8 main-content">
<div class="max-w-none">
<!-- Preserve existing schedulerTest main content below -->
<div class="flex-1 flex p-3 space-x-2">
<div class="w-56 flex-shrink-0 flex flex-col space-y-4">
<button class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90 transition-colors mt-4" onclick="openCreateModal()">
<span class="material-symbols-outlined text-base">add</span>
<span>Create</span>
</button>
<div class="p-2">
<div class="flex items-center justify-between mb-1">
<h3 id="sidebarMonthDisplay" class="text-sm font-semibold text-text-light dark:text-text-dark">October 2025</h3>
<div class="flex items-center space-x-1">
<button id="sidebarPrevBtn" class="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-200 flex items-center justify-center">
<span class="material-symbols-outlined text-xs text-gray-600 dark:text-gray-400 hover:text-white dark:hover:text-gray-800">chevron_left</span>
</button>
<button id="sidebarNextBtn" class="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-200 flex items-center justify-center">
<span class="material-symbols-outlined text-xs text-gray-600 dark:text-gray-400 hover:text-white dark:hover:text-gray-800">chevron_right</span>
</button>
</div>
</div>
<div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-600 dark:text-gray-400 mb-1">
<span>S</span>
<span>M</span>
<span>T</span>
<span>W</span>
<span>T</span>
<span>F</span>
<span>S</span>
</div>
<div id="sidebarCalendarGrid" class="grid grid-cols-7">
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">28</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">29</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-blue-600 dark:text-blue-400 font-semibold hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">30</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">
<span class="bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-semibold">1</span>
</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">2</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">3</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">4</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">5</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">6</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">7</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">
<span class="bg-blue-100 text-blue-600 rounded-full w-5 h-5 flex items-center justify-center text-xs">8</span>
</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">9</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">10</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">11</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">12</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">13</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">14</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">15</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">16</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">17</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">18</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">19</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">20</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">21</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">22</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">23</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">24</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">25</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">26</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">27</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">28</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">29</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">30</div>
<div class="h-8 p-1 flex items-center justify-center text-xs hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">31</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">1</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">2</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">3</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">4</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">5</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">6</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">7</div>
<div class="h-8 p-1 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg cursor-pointer">8</div>
</div>
<div class="mt-4 pt-4 border-t border-border-light dark:border-border-dark">
<div class="flex items-center justify-between">
                 <h4 class="font-semibold text-text-light dark:text-text-dark">My Events</h4>
</div>
<div id="myEventsList" class="mt-2 space-y-2 text-sm"></div>
</div>
</div>
</div>
<div class="flex-1 bg-card-light dark:bg-card-dark p-6 rounded-lg shadow">
<div class="flex items-center justify-between mb-6">
<div class="flex items-center space-x-4">
<span class="material-symbols-outlined text-muted-light dark:text-muted-dark">calendar_month</span>
<div class="flex items-center space-x-1">
<button id="mainPrevBtn" class="p-1 rounded-md hover:bg-background-light dark:hover:bg-card-dark text-muted-light dark:text-muted-dark">
<span class="material-symbols-outlined">chevron_left</span>
</button>
<button id="mainNextBtn" class="p-1 rounded-md hover:bg-background-light dark:hover:bg-card-dark text-muted-light dark:text-muted-dark">
<span class="material-symbols-outlined">chevron_right</span>
</button>
</div>
<h3 id="mainMonthDisplay" class="text-xl font-semibold text-text-light dark:text-text-dark">October 2025</h3>
</div>
<div class="flex items-center space-x-4">
<button id="todayBtn" class="px-4 py-1.5 rounded-full border border-border-light bg-card-light text-text-light text-sm font-medium hover:bg-gray-50 dark:bg-background-dark/50 dark:text-text-dark dark:border-border-dark dark:hover:bg-card-dark">Today</button>
<div class="relative">
<button id="viewBtn" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-text-light bg-card-light border border-border-light rounded-full hover:bg-gray-50 dark:bg-background-dark/50 dark:text-text-dark dark:border-border-dark dark:hover:bg-card-dark">
<span id="viewBtnLabel">Month</span>
<span class="material-symbols-outlined text-base">expand_more</span>
</button>
<div id="viewDropdown" class="absolute right-0 mt-2 w-40 bg-card-light dark:bg-background-dark rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50 hidden overflow-hidden">
<button data-view="Month" class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800">Month</button>
<button data-view="Week" class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800">Week</button>
<button data-view="Day" class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800">Day</button>
</div>
</div>

</div>
</div>
<!-- Main Calendar Grid - Dynamically Generated -->
<div id="mainCalendarGrid" class="grid grid-cols-7 border-t border-l border-border-light dark:border-border-dark">
    <!-- Calendar will be generated here by JavaScript -->
</div>

<!-- Day Calendar Container (hidden by default, shown when selecting a date in mini calendar) -->
<div id="dayCalendarContainer" class="hidden border border-border-light dark:border-border-dark rounded-lg overflow-hidden">
    <!-- Header with timezone, weekday and date number -->
    <div class="grid grid-cols-[80px_1fr] bg-card-light dark:bg-card-dark">
        <div class="p-3 flex flex-col items-start justify-start">
            <div id="dayHeaderDow" class="text-xs text-gray-500 tracking-wide leading-tight">FRI</div>
            <div id="dayHeaderDate" class="text-3xl font-semibold text-gray-800 dark:text-gray-100">3</div>
        </div>
        <div></div>
    </div>
    <!-- Timezone label above the divider line -->
    <div class="grid grid-cols-[80px_1fr]">
        <div class="text-[11px] text-gray-500 px-2">GMT+08</div>
        <div></div>
    </div>
    <!-- Full-width divider line under the timezone label -->
    <div class="h-px bg-gray-200"></div>
    <!-- 24h grid -->
    <div id="dayHoursGrid" class="grid grid-cols-[80px_1fr]"></div>
    
</div>

<!-- Week Calendar Container (hidden by default) -->
<div id="weekCalendarContainer" class="hidden border border-border-light dark:border-border-dark rounded-lg overflow-hidden">
    <div class="bg-card-light dark:bg-card-dark">
        <div id="weekHeader" class="grid" style="grid-template-columns: 80px repeat(7, 1fr);"></div>
    </div>
    <div class="h-px bg-gray-200 dark:bg-gray-700"></div>
    <div id="weekGrid" class="grid" style="grid-template-columns: 80px repeat(7, 1fr);"></div>
</div>

<script>
// Event Details Modal (inserted outside other modals so it can open independently)
</script>

<!-- Event Details Modal -->
<div id="eventDetailModal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-[9999]">
    <div class="bg-white dark:bg-card-dark rounded-2xl shadow-2xl w-full max-w-xl mx-4 max-h-[85vh] overflow-y-auto">
        <div class="p-4 border-b flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span id="detailColorDot" class="w-3.5 h-3.5 rounded-full bg-blue-500"></span>
                <h3 id="detailTitle" class="text-lg font-medium text-gray-900">Power Session</h3>
            </div>
            <div class="flex items-center gap-3 text-gray-500">
                <span id="detailEditBtn" class="material-symbols-outlined text-[20px] cursor-pointer">edit</span>
                <span id="detailDeleteBtn" class="material-symbols-outlined text-[20px] cursor-pointer" title="Delete">delete</span>
                <span class="material-symbols-outlined text-[20px] cursor-pointer">notifications</span>
                <button id="detailCloseBtn" class="p-1 rounded-full hover:bg-gray-100">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
        <div class="p-4">
            <p id="detailDate" class="text-sm text-gray-600 mb-3">Thursday, 2 October</p>

            <div class="mt-4 space-y-3">
                <div class="flex items-start gap-3 text-gray-700">
                    <span class="material-symbols-outlined text-[20px] text-gray-500">location_on</span>
                    <span id="detailLocation">RMA</span>
                </div>
                <div class="flex items-start gap-3 text-gray-700">
                    <span class="material-symbols-outlined text-[20px] text-gray-500">notifications</span>
                    <span id="detailReminder">The day before at 5pm</span>
                </div>
                <div class="flex items-start gap-3 text-gray-700">
                    <span class="material-symbols-outlined text-[20px] text-gray-500">account_circle</span>
                    <span id="detailOrganizer">Chrisjane Patricio</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Context menu for calendar events
</script>

<!-- Event Context Menu -->
<div id="eventContextMenu" class="fixed z-[10000] hidden bg-white dark:bg-card-dark rounded-xl shadow-xl border border-gray-200 dark:border-border-dark w-56 select-none overflow-hidden">
    <button id="ctxDelete" class="w-full text-left px-2 py-1.5 flex items-center gap-2 hover:bg-gray-100 bg-gray-50 rounded-t-xl">
        <span class="material-symbols-outlined text-gray-600">delete</span>
        <span class="text-gray-800">Delete</span>
    </button>
    <div class="h-px bg-gray-200"></div>
    <div class="px-2 py-1.5 rounded-b-xl">
        <div class="grid grid-cols-6 gap-2">
            <button class="w-5 h-5 rounded-full bg-red-500 cursor-pointer" data-color-choice="bg-red-500" title="Tomato"></button>
            <button class="w-5 h-5 rounded-full bg-orange-500 cursor-pointer" data-color-choice="bg-orange-500" title="Orange"></button>
            <button class="w-5 h-5 rounded-full bg-yellow-400 cursor-pointer" data-color-choice="bg-yellow-400" title="Yellow"></button>
            <button class="w-5 h-5 rounded-full bg-green-400 cursor-pointer" data-color-choice="bg-green-400" title="Mint"></button>
            <button class="w-5 h-5 rounded-full bg-green-600 cursor-pointer" data-color-choice="bg-green-600" title="Forest Green"></button>
            <button class="w-5 h-5 rounded-full bg-blue-400 cursor-pointer" data-color-choice="bg-blue-400" title="Sky Blue"></button>
            <button class="w-5 h-5 rounded-full bg-blue-600 cursor-pointer" data-color-choice="bg-blue-600" title="Navy Blue"></button>
            <button class="w-5 h-5 rounded-full bg-purple-400 cursor-pointer" data-color-choice="bg-purple-400" title="Lavender"></button>
            <button class="w-5 h-5 rounded-full bg-purple-600 cursor-pointer" data-color-choice="bg-purple-600" title="Plum"></button>
            <button class="w-5 h-5 rounded-full bg-gray-400 cursor-pointer" data-color-choice="bg-gray-400" title="Gray"></button>
            <button class="w-5 h-5 rounded-full bg-pink-300 cursor-pointer" data-color-choice="bg-pink-300" title="Pink"></button>
            <button class="w-5 h-5 rounded-full border-2 border-gray-300 bg-transparent cursor-pointer" data-color-choice="bg-transparent" title="No Color"></button>
        </div>
    </div>
</div>

<script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const appContainer = document.getElementById('app-container');
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('main');
            const sidebarLogoText = document.querySelector('.sidebar-logo-text');
            const sidebarTexts = document.querySelectorAll('.sidebar-text');
            const sidebarProfileInfo = document.querySelector('.sidebar-profile-info');
            const sidebarProfilePicture = document.querySelector('.sidebar-profile-picture');
            const openIcon = document.querySelector('.sidebar-toggle-icon-open');
            const closedIcon = document.querySelector('.sidebar-toggle-icon-closed');
            const navLinks = document.querySelectorAll('.sidebar-nav-link');
            const profileContainer = document.querySelector('.profile-container');
            const toggleContainer = document.querySelector('.sidebar-toggle-container');
            
            // Function to toggle sidebar
            const toggleSidebar = () => {
                const isCollapsed = appContainer.classList.contains('sidebar-collapsed');
                if (isCollapsed) {
                    // Expanding sidebar
                    appContainer.classList.remove('sidebar-collapsed');
                    appContainer.classList.add('sidebar-expanded');
                    sidebar.style.width = '16rem';
                    mainContent.style.marginLeft = '0';
                    sidebarLogoText.classList.remove('hidden');
                    sidebarTexts.forEach(text => text.classList.remove('hidden'));
                    sidebarProfileInfo.classList.remove('hidden');
                    sidebarProfilePicture.classList.remove('hidden');
                    openIcon.style.display = 'block';
                    closedIcon.style.display = 'none';
                    navLinks.forEach(link => link.classList.remove('justify-center'));
                    profileContainer.classList.remove('justify-center');
                    if (toggleContainer) toggleContainer.classList.remove('justify-center');
                 } else {
                     // Collapsing sidebar
                     appContainer.classList.add('sidebar-collapsed');
                     appContainer.classList.remove('sidebar-expanded');
                     sidebar.style.width = '5rem';
                     mainContent.style.marginLeft = '0';
                    sidebarLogoText.classList.add('hidden');
                    sidebarTexts.forEach(text => text.classList.add('hidden'));
                    sidebarProfileInfo.classList.add('hidden');
                    sidebarProfilePicture.classList.add('hidden');
                    openIcon.style.display = 'none';
                    closedIcon.style.display = 'block';
                    navLinks.forEach(link => link.classList.add('justify-center'));
                    profileContainer.classList.add('justify-center');
                    if (toggleContainer) toggleContainer.classList.add('justify-center');
                }
            };
            
            sidebarToggle.addEventListener('click', toggleSidebar);
            
            // Function to toggle dark mode
            const toggleDarkMode = (enable) => {
                if (enable) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
                // Force a re-render to ensure all elements update
                document.body.offsetHeight;
            };
            
            // Check for saved theme in localStorage
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                toggleDarkMode(true);
            } else {
                toggleDarkMode(false);
            }
            
            // Event listener for theme toggle button
            themeToggle.addEventListener('click', () => {
                const isCurrentlyDark = document.documentElement.classList.contains('dark');
                toggleDarkMode(!isCurrentlyDark);
            });

            // Location Autocomplete for Scheduler
            let schedulerAutocompleteService = null;
            const schedulerLocationInput = document.getElementById('locationInput');
            const schedulerLocationSuggestions = document.getElementById('schedulerLocationSuggestions');
            const schedulerSuggestionsList = document.getElementById('schedulerSuggestionsList');

            const loadSchedulerGoogleMaps = () => {
                if (window.google && window.google.maps && window.google.maps.places) {
                    return Promise.resolve();
                }
                
                return new Promise((resolve, reject) => {
                    // Check if Google Maps is already loaded
                    if (document.querySelector('script[src*="maps.googleapis.com"]')) {
                        const checkLoaded = () => {
                            if (window.google && window.google.maps && window.google.maps.places) {
                                resolve();
                            } else {
                                setTimeout(checkLoaded, 100);
                            }
                        };
                        checkLoaded();
                        return;
                    }
                    
                    // If not loaded, try to load it with proper async loading
                    const script = document.createElement('script');
                    script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyD1p_x_nw6wT7_zUnILTuG17fHNOf0zFC4&libraries=places&loading=async&callback=initSchedulerMapsCallback';
                    script.async = true;
                    script.defer = true;
                    script.onerror = () => {
                        console.warn('Google Maps API failed to load for scheduler. Using fallback suggestions only.');
                        reject(new Error('Failed to load Google Maps API'));
                    };
                    
                    // Create callback function
                    window.initSchedulerMapsCallback = () => {
                        delete window.initSchedulerMapsCallback;
                        resolve();
                    };
                    
                    document.head.appendChild(script);
                });
            };

            const showSchedulerLocationSuggestions = async (query) => {
                if (!query.trim() || query.length < 2) {
                    schedulerLocationSuggestions.classList.add('hidden');
                    return;
                }

                console.log('Searching for:', query); // Debug log
                
                // Always show fallback suggestions first for immediate response
                showSchedulerFallbackSuggestions(query);

                // Try to load Google Places API in the background (non-blocking)
                try {
                    await loadSchedulerGoogleMaps();
                    
                    if (!schedulerAutocompleteService && window.google && window.google.maps && window.google.maps.places) {
                        schedulerAutocompleteService = new google.maps.places.AutocompleteService();
                    }

                    if (schedulerAutocompleteService) {
                        // Use the legacy API which is still working - restricted to Iloilo only
                        schedulerAutocompleteService.getPlacePredictions({
                            input: query,
                            types: ['geocode', 'establishment'],
                            componentRestrictions: { country: 'ph' },
                            location: new google.maps.LatLng(10.7202, 122.5621), // Iloilo City coordinates
                            radius: 50000 // 50km radius around Iloilo
                        }, (predictions, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK && predictions) {
                                // Filter predictions to only show Iloilo locations (strict filtering)
                                const iloiloPredictions = predictions.filter(prediction => {
                                    const desc = prediction.description.toLowerCase();
                                    return desc.includes('iloilo') && 
                                           !desc.includes('manila') &&
                                           !desc.includes('cebu') &&
                                           !desc.includes('davao') &&
                                           !desc.includes('baguio') &&
                                           !desc.includes('bacolod') &&
                                           !desc.includes('tacloban') &&
                                           !desc.includes('antique') &&
                                           !desc.includes('capiz') &&
                                           !desc.includes('aklan') &&
                                           !desc.includes('negros') &&
                                           !desc.includes('guimaras');
                                });
                                if (iloiloPredictions.length > 0) {
                                    displaySchedulerSuggestions(iloiloPredictions);
                                }
                                // If no Iloilo predictions, keep fallback suggestions
                            } else {
                                console.log('Places API status:', status);
                                // Keep fallback suggestions if API fails
                            }
                        });
                    }

                } catch (error) {
                    // Silently fail - fallback suggestions are already shown
                    console.log('Scheduler Places API unavailable, using fallback suggestions');
                }
            };

            const displaySchedulerSuggestions = (predictions) => {
                schedulerSuggestionsList.innerHTML = '';
                
                predictions.slice(0, 5).forEach((prediction, index) => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors select-none';
                    suggestionItem.style.pointerEvents = 'auto';
                    suggestionItem.innerHTML = `
                        <span class="material-symbols-outlined text-gray-500 text-sm">place</span>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900">${prediction.structured_formatting.main_text}</p>
                            <p class="text-xs text-gray-500">${prediction.structured_formatting.secondary_text}</p>
                        </div>
                    `;
                    
                    // Add click event with proper event handling
                    suggestionItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        schedulerLocationInput.value = prediction.description;
                        schedulerLocationSuggestions.classList.add('hidden');
                        // Trigger input event to update any other listeners
                        schedulerLocationInput.dispatchEvent(new Event('input', { bubbles: true }));
                    });
                    
                    // Add mousedown event as backup
                    suggestionItem.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                    
                    schedulerSuggestionsList.appendChild(suggestionItem);
                });
                
                schedulerLocationSuggestions.classList.remove('hidden');
            };

            const showSchedulerFallbackSuggestions = (query) => {
                console.log('Showing ILOILO-ONLY fallback suggestions for:', query); // Debug log
                
                // STRICT ILOILO-ONLY LOCATIONS - No other provinces or cities
                const commonLocations = [
                    // Iloilo City and Province - Main Areas
                    'Iloilo City, Philippines', 'Central Philippine University, Iloilo City, Philippines', 'University of the Philippines Visayas, Iloilo City, Philippines',
                    'West Visayas State University, Iloilo City, Philippines', 'University of San Agustin, Iloilo City, Philippines',
                    'St. Paul University Iloilo, Iloilo City, Philippines', 'Iloilo Science and Technology University, Iloilo City, Philippines',
                    
                    // Iloilo City Districts and Barangays
                    'Mandurriao, Iloilo City, Philippines', 'Molo, Iloilo City, Philippines', 'Jaro, Iloilo City, Philippines',
                    'La Paz, Iloilo City, Philippines', 'Lapuz, Iloilo City, Philippines', 'Arevalo, Iloilo City, Philippines',
                    'City Proper, Iloilo City, Philippines', 'Villa Arevalo, Iloilo City, Philippines',
                    
                    // Iloilo Province Municipalities
                    'Miagao, Iloilo, Philippines', 'San Joaquin, Iloilo, Philippines', 'Guimbal, Iloilo, Philippines',
                    'Tigbauan, Iloilo, Philippines', 'Oton, Iloilo, Philippines', 'Pavia, Iloilo, Philippines',
                    'Santa Barbara, Iloilo, Philippines', 'New Lucena, Iloilo, Philippines', 'Zarraga, Iloilo, Philippines',
                    'Leganes, Iloilo, Philippines', 'Dumangas, Iloilo, Philippines', 'Barotac Nuevo, Iloilo, Philippines',
                    'Barotac Viejo, Iloilo, Philippines', 'Anilao, Iloilo, Philippines', 'Banate, Iloilo, Philippines',
                    'Bingawan, Iloilo, Philippines', 'Cabatuan, Iloilo, Philippines', 'Calinog, Iloilo, Philippines',
                    'Carles, Iloilo, Philippines', 'Concepcion, Iloilo, Philippines', 'Dingle, Iloilo, Philippines',
                    'Dueñas, Iloilo, Philippines', 'Estancia, Iloilo, Philippines',
                    'Igbaras, Iloilo, Philippines', 'Janiuay, Iloilo, Philippines', 'Lambunao, Iloilo, Philippines',
                    'Maasin, Iloilo, Philippines', 'Passi City, Iloilo, Philippines', 'Pototan, Iloilo, Philippines',
                    'San Dionisio, Iloilo, Philippines', 'San Enrique, Iloilo, Philippines', 'San Miguel, Iloilo, Philippines',
                    'San Rafael, Iloilo, Philippines', 'Sara, Iloilo, Philippines', 'Tubungan, Iloilo, Philippines',
                    
                    // Popular Iloilo Landmarks and Places
                    'Iloilo Business Park, Mandurriao, Iloilo City, Philippines', 'SM City Iloilo, Mandurriao, Iloilo City, Philippines',
                    'Robinsons Place Iloilo, La Paz, Iloilo City, Philippines', 'Festive Walk Iloilo, Mandurriao, Iloilo City, Philippines',
                    'Iloilo Convention Center, Mandurriao, Iloilo City, Philippines', 'Iloilo International Airport, Cabatuan, Iloilo, Philippines',
                    'Miagao Church, Miagao, Iloilo, Philippines', 'Jaro Cathedral, Jaro, Iloilo City, Philippines',
                    'Molo Church, Molo, Iloilo City, Philippines', 'Casa Mariquit, Jaro, Iloilo City, Philippines',
                    'Iloilo Museum of Contemporary Art, Mandurriao, Iloilo City, Philippines', 'Plaza Libertad, City Proper, Iloilo City, Philippines',
                    'Esplanade, Iloilo City, Philippines', 'Iloilo River, Iloilo City, Philippines',
                    
                    // Iloilo Universities and Schools
                    'Central Philippine University, Jaro, Iloilo City, Philippines', 'University of the Philippines Visayas, Miagao, Iloilo, Philippines',
                    'West Visayas State University, La Paz, Iloilo City, Philippines', 'University of San Agustin, Jaro, Iloilo City, Philippines',
                    'St. Paul University Iloilo, Jaro, Iloilo City, Philippines', 'Iloilo Science and Technology University, La Paz, Iloilo City, Philippines',
                    'John B. Lacson Foundation Maritime University, Molo, Iloilo City, Philippines', 'Iloilo Doctors College, Mandurriao, Iloilo City, Philippines',
                    'Assumption Iloilo, Jaro, Iloilo City, Philippines', 'Ateneo de Iloilo, Mandurriao, Iloilo City, Philippines',
                    'Colegio de San Jose, Jaro, Iloilo City, Philippines', 'St. Therese MTC Colleges, La Paz, Iloilo City, Philippines',
                    
                    // Iloilo Hospitals and Medical Centers
                    'Iloilo Doctors Hospital, Mandurriao, Iloilo City, Philippines', 'West Visayas State University Medical Center, La Paz, Iloilo City, Philippines',
                    'St. Paul Hospital Iloilo, Jaro, Iloilo City, Philippines', 'Iloilo Mission Hospital, Jaro, Iloilo City, Philippines',
                    'The Medical City Iloilo, Mandurriao, Iloilo City, Philippines', 'QualiMed Hospital Iloilo, Mandurriao, Iloilo City, Philippines',
                    
                    // Iloilo Government Offices
                    'Iloilo Provincial Capitol, Iloilo City, Philippines', 'Iloilo City Hall, City Proper, Iloilo City, Philippines',
                    'Iloilo City Government Center, Mandurriao, Iloilo City, Philippines', 'Department of Trade and Industry Iloilo, Iloilo City, Philippines',
                    'Bureau of Internal Revenue Iloilo, Iloilo City, Philippines', 'Social Security System Iloilo, Iloilo City, Philippines',
                    
                    // Iloilo Shopping and Commercial Areas
                    'Gaisano City Iloilo, La Paz, Iloilo City, Philippines', 'Atrium Mall, Mandurriao, Iloilo City, Philippines',
                    'Plaza Libertad Commercial Complex, City Proper, Iloilo City, Philippines', 'Iloilo Central Market, City Proper, Iloilo City, Philippines',
                    'Iloilo Terminal Market, City Proper, Iloilo City, Philippines',                     'Megaworld Iloilo Business Park, Mandurriao, Iloilo City, Philippines'
                ];

                const filtered = commonLocations.filter(location => 
                    location.toLowerCase().includes(query.toLowerCase())
                );

                console.log('Filtered results:', filtered.length, 'for query:', query); // Debug log

                if (filtered.length > 0) {
                    schedulerSuggestionsList.innerHTML = '';
                    filtered.slice(0, 8).forEach(location => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.className = 'flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors select-none';
                        suggestionItem.style.pointerEvents = 'auto';
                        suggestionItem.innerHTML = `
                            <span class="material-symbols-outlined text-gray-500 text-sm">place</span>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">${location}</p>
                                <p class="text-xs text-gray-500">Suggested location</p>
                            </div>
                        `;
                        
                        // Add click event with proper event handling
                        suggestionItem.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            schedulerLocationInput.value = location;
                            schedulerLocationSuggestions.classList.add('hidden');
                            // Trigger input event to update any other listeners
                            schedulerLocationInput.dispatchEvent(new Event('input', { bubbles: true }));
                        });
                        
                        // Add mousedown event as backup
                        suggestionItem.addEventListener('mousedown', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                        });
                        
                        schedulerSuggestionsList.appendChild(suggestionItem);
                    });
                    schedulerLocationSuggestions.classList.remove('hidden');
                } else {
                    schedulerLocationSuggestions.classList.add('hidden');
                }
            };

            // Add event listener to scheduler location input
            if (schedulerLocationInput) {
                let schedulerTimeoutId;
                schedulerLocationInput.addEventListener('input', (e) => {
                    clearTimeout(schedulerTimeoutId);
                    const query = e.target.value.trim();
                    
                    schedulerTimeoutId = setTimeout(() => {
                        showSchedulerLocationSuggestions(query);
                    }, 300);
                });

                // Hide suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!schedulerLocationInput.contains(e.target) && !schedulerLocationSuggestions.contains(e.target)) {
                        schedulerLocationSuggestions.classList.add('hidden');
                    }
                });

                // Handle keyboard navigation
                schedulerLocationInput.addEventListener('keydown', (e) => {
                    const suggestions = schedulerSuggestionsList.querySelectorAll('div');
                    const activeSuggestion = schedulerSuggestionsList.querySelector('[data-active="true"]');
                    
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (activeSuggestion) {
                            activeSuggestion.classList.remove('bg-blue-100');
                            activeSuggestion.removeAttribute('data-active');
                            const next = activeSuggestion.nextElementSibling;
                            if (next) {
                                next.classList.add('bg-blue-100');
                                next.setAttribute('data-active', 'true');
                            }
                        } else if (suggestions[0]) {
                            suggestions[0].classList.add('bg-blue-100');
                            suggestions[0].setAttribute('data-active', 'true');
                        }
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (activeSuggestion) {
                            activeSuggestion.classList.remove('bg-blue-100');
                            activeSuggestion.removeAttribute('data-active');
                            const prev = activeSuggestion.previousElementSibling;
                            if (prev) {
                                prev.classList.add('bg-blue-100');
                                prev.setAttribute('data-active', 'true');
                            }
                        }
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (activeSuggestion) {
                            activeSuggestion.click();
                        }
                    } else if (e.key === 'Escape') {
                        schedulerLocationSuggestions.classList.add('hidden');
                    }
                });
            }
        });
 </script>
 
 <!-- Create Event Modal -->
<div id="createModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div id="createModalCard" class="bg-white dark:bg-card-dark rounded-lg shadow-xl w-full max-w-md mx-4 max-h-[85vh] overflow-y-auto">
         <!-- Modal Header -->
        <div id="createModalHeader" class="flex items-center justify-between p-4 border-b">
             <div class="flex items-center space-x-2">
                 <span class="material-symbols-outlined text-gray-600">menu</span>
             </div>
            <button onclick="closeCreateModal()" class="text-gray-500 hover:text-gray-700" data-no-drag>
                 <span class="material-symbols-outlined">close</span>
             </button>
         </div>
         
         <!-- Modal Content -->
         <div class="p-4">
             <!-- Title Input -->
            <input type="text" placeholder="Add title" class="w-full text-xl font-medium bg-transparent border-0 border-b border-gray-300 focus:border-blue-500 focus:ring-0 focus:outline-none focus:shadow-none pb-2 mb-4" id="eventTitle" name="eventTitle" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" style="box-shadow: none !important;">
             
             
             <!-- Event Details -->
             <div class="space-y-4">
                 <!-- Date and Time -->
                 <div class="flex items-start space-x-3">
                     <span class="material-symbols-outlined text-gray-600 mt-1">schedule</span>
                     <div class="flex-1">
                         <!-- Date and Time Display -->
                         <div class="flex items-start space-x-3">
                             <div class="flex-1">
                                 <div class="flex items-center space-x-2">
                                     <button onclick="toggleTimePicker()" class="px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300">
                                         Wednesday, 1 October
                                     </button>
                                     <button id="startTimeBtn" class="px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300" onclick="toggleTimePicker('start')">
                                         4:30pm
                                     </button>
                                     <span class="text-gray-400 dark:text-gray-500">-</span>
                                     <button id="endTimeBtn" class="px-3 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300" onclick="toggleTimePicker('end')">
                                         5:30pm
                                     </button>
                                 </div>
                                 <div class="text-xs text-gray-500 mt-2 relative">
                                     <button class="hover:text-gray-700 dark:hover:text-gray-300 text-gray-600 dark:text-gray-400" onclick="toggleRepeatDropdown()" id="repeatButton">Doesn't repeat</button>
                                     <!-- Repeat Options Dropdown -->
                                     <div id="repeatDropdown" class="hidden absolute top-6 left-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-48">
                                         <div class="py-1">
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Does not repeat')">Does not repeat</div>
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Daily')">Daily</div>
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Weekly on Wednesday')">Weekly on Wednesday</div>
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Monthly on the first Wednesday')">Monthly on the first Wednesday</div>
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Annually on October 1')">Annually on October 1</div>
                                             <div class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectRepeatOption('Every weekday (Monday to Friday)')">Every weekday (Monday to Friday)</div>
                                         </div>
</div>
</div>
</div>
</div>
                         
                         <!-- Hidden time picker dropdown -->
                         <div id="timePicker" class="hidden mt-3 p-4 bg-white border border-gray-200 rounded-lg shadow-lg space-y-3">
                             <!-- Date and Time Inputs -->
                             <div class="flex items-center space-x-2">
                                 <button class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700">
                                     Wednesday, 1 October
                                 </button>
                                 <button class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700">
                                     4:30pm
                                 </button>
                                 <span class="text-gray-400">-</span>
                                 <button class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700">
                                     5:30pm
                                 </button>
</div>
                             
                             <!-- All day and Time zone -->
                             <div class="flex items-center space-x-4">
                                 <label class="flex items-center space-x-2 cursor-pointer">
                                     <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                     <span class="text-sm text-gray-700">All day</span>
                                 </label>
                                 <button class="text-sm text-blue-600 hover:text-blue-800">Time zone</button>
</div>
                             
                             <!-- Repeat dropdown -->
                             <div>
                                 <button class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700 flex items-center space-x-2">
                                     <span>Doesn't repeat</span>
                                     <span class="material-symbols-outlined text-xs">keyboard_arrow_down</span>
                                 </button>
</div>
</div>
</div>
</div>
                 
                 
                <!-- Event Type Selector (replaces Google Meet row) -->
                <div class="flex items-center space-x-3 text-gray-700">
                    <span class="material-symbols-outlined">category</span>
                    <label for="eventTypeSelect" class="sr-only">Type</label>
                    <select id="eventTypeSelect" class="bg-transparent border-0 text-sm font-medium focus:outline-none">
                        <option value="Event">Event</option>
                        <option value="Activity">Activity</option>
                    </select>
                </div>
                 
                 <!-- Add Location -->
                 <div class="flex items-center space-x-3 text-gray-600 hover:text-gray-800 cursor-pointer" onclick="editLocation()">
                     <span class="material-symbols-outlined">place</span>
                     <div class="flex-1 relative">
                        <input type="text" id="locationInput" name="locationInput" placeholder="Add location" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" class="hidden bg-transparent border-0 border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 outline-none w-full text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400" style="box-shadow: none !important;">
                        <div id="schedulerLocationSuggestions" class="hidden absolute top-full left-0 right-0 mt-1 rounded-lg border border-gray-200 bg-white shadow-lg max-h-48 overflow-y-auto z-50">
                            <div id="schedulerSuggestionsList" class="p-2 space-y-1">
                                <!-- Location suggestions will appear here -->
                            </div>
                        </div>
                        <span id="locationText" class="block">Add location</span>
                     </div>
</div>
                 
                 <!-- Add Description -->
                 <div class="flex items-center space-x-3 text-gray-600 hover:text-gray-800 cursor-pointer" onclick="editDescription()">
                     <span class="material-symbols-outlined">description</span>
                    <input type="text" id="descriptionInput" name="descriptionInput" placeholder="Add description" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" class="hidden bg-transparent border-0 border-b border-gray-300 focus:border-blue-500 outline-none flex-1" style="box-shadow: none !important;">
                     <span id="descriptionText">Add description or a Google Drive attachment</span>
</div>
                 
                 <!-- Organizer -->
                 <div class="flex items-start space-x-3">
                     <span class="material-symbols-outlined text-gray-600 mt-1">calendar_today</span>
                     <div class="flex-1">
                         <div class="flex items-center space-x-2 cursor-pointer" onclick="toggleUserSettings()">
                             <span class="font-medium">Admin User</span>
                             <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
</div>
                         <div class="text-xs text-gray-500 mt-1">Busy • Notify 30 minutes before</div>
                         
                         <!-- User Settings Panel -->
                         <div id="userSettingsPanel" class="hidden mt-3 p-4 bg-white border border-gray-200 rounded-lg shadow-lg space-y-3">
                             <!-- Calendar and Availability Row -->
                             <div class="flex items-center space-x-3">
                                 <span class="material-symbols-outlined text-gray-600">calendar_today</span>
                                 <select class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:outline-none">
                                     <option>Chrisjane Patricio</option>
                                 </select>
                                 <div class="relative">
                                     <button onclick="toggleColorPicker()" class="w-4 h-4 rounded-full bg-blue-500 border border-gray-300 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"></button>
                                     <!-- Color Picker Dropdown -->
                                     <div id="colorPicker" class="hidden absolute top-0 left-8 bg-white dark:bg-card-dark border border-gray-200 dark:border-border-dark rounded-lg shadow-lg z-20 p-3" style="min-width: 80px;">
                                         <div class="grid grid-cols-2 gap-2" style="width: 60px;">
                                             <div class="w-6 h-6 rounded-full bg-red-500 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('red', this)" title="Tomato">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Tomato</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-orange-500 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('orange', this)" title="Orange">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Orange</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-green-400 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('green', this)" title="Mint">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Mint</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-blue-400 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('blue', this)" title="Sky Blue">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Sky Blue</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-purple-400 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('purple', this)" title="Lavender">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Lavender</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-gray-400 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('gray', this)" title="Gray">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Gray</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-pink-300 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('pink', this)" title="Pink">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Pink</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-yellow-400 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('yellow', this)" title="Yellow">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Yellow</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-green-600 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('darkgreen', this)" title="Forest Green">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Forest Green</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-blue-600 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('darkblue', this)" title="Navy Blue">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Navy Blue</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-purple-600 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('darkpurple', this)" title="Plum">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Plum</div>
</div>
                                             <div class="w-6 h-6 rounded-full bg-transparent border-2 border-gray-300 cursor-pointer hover:ring-2 hover:ring-gray-300 relative group" onclick="selectColor('transparent', this)" title="No Color">
                                                 <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">No Color</div>
</div>
</div>
</div>
</div>
                             
                             <!-- Availability Row -->
                             <div class="flex items-center space-x-3">
                                 <span class="material-symbols-outlined text-gray-600">work</span>
                                 <select class="bg-transparent border-0 text-sm focus:outline-none">
                                     <option>Busy</option>
                                     <option>Available</option>
                                     <option>Tentative</option>
                                 </select>
</div>
                             
                             
                             <!-- Notification Row -->
                             <div class="flex items-center space-x-3">
                                 <span class="material-symbols-outlined text-gray-600">notifications</span>
                                 <select class="bg-transparent border-0 text-sm focus:outline-none">
                                     <option>30 minutes before</option>
                                     <option>1 hour before</option>
                                     <option>1 day before</option>
                                     <option>None</option>
                                 </select>
                             </div>
                             
                             <!-- Add Notification Link -->
                             <div class="text-blue-600 text-sm cursor-pointer hover:text-blue-800 relative" onclick="toggleNotificationDropdown()">
                                 Add notification
                                 
                                 <!-- Notification Dropdown -->
                                 <div id="notificationDropdown" class="hidden absolute bottom-6 left-0 bg-white border border-gray-200 rounded-lg shadow-lg z-20 min-w-48">
                                     <div class="py-2">
                                         <div class="px-4 py-2 text-xs font-medium text-gray-500 border-b border-gray-100">When the event starts</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('5 minutes before')">5 minutes before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('10 minutes before')">10 minutes before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('15 minutes before')">15 minutes before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('30 minutes before')">30 minutes before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('1 hour before')">1 hour before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('1 day before')">1 day before</div>
                                         <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('Custom...')">Custom...</div>
                                     </div>
                                 </div>
                             </div>
                             
                         </div>
                     </div>
                 </div>
             </div>
         </div>
         
         <!-- Modal Footer -->
         <div class="flex items-center justify-end p-4 border-t">
             <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-medium" onclick="saveEvent(); console.log('Button clicked');">Save</button>
         </div>
     </div>
 </div>
 
 <!-- Date Picker Calendar Popup -->
 <div id="datePickerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
     <div class="bg-white rounded-lg shadow-xl w-full max-w-sm mx-4">
         <!-- Calendar Content -->
         <div class="p-4">
             <!-- Month Navigation -->
             <div class="flex items-center justify-between mb-4">
                 <button class="p-2 hover:bg-gray-800 dark:hover:bg-gray-200 rounded-lg" onclick="prevMonth()">
                     <span class="material-symbols-outlined text-gray-600 dark:text-gray-400 hover:text-white dark:hover:text-gray-800">chevron_left</span>
                 </button>
                 <h4 id="currentMonthDisplay" class="text-lg font-medium">October 2025</h4>
                 <button class="p-2 hover:bg-gray-800 dark:hover:bg-gray-200 rounded-lg" onclick="nextMonth()">
                     <span class="material-symbols-outlined text-gray-600 dark:text-gray-400 hover:text-white dark:hover:text-gray-800">chevron_right</span>
                 </button>
             </div>
             
             <!-- Days of Week -->
             <div class="grid grid-cols-7 gap-1 mb-2">
                 <div class="text-center text-sm font-medium text-gray-500 py-2">S</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">M</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">T</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">W</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">T</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">F</div>
                 <div class="text-center text-sm font-medium text-gray-500 py-2">S</div>
             </div>
             
             <!-- Calendar Grid -->
             <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                 <!-- Previous month dates -->
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">28</button>
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">29</button>
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">30</button>
                 <!-- Current month dates -->
                 <button class="h-10 text-center text-sm hover:bg-gray-100 rounded-lg bg-blue-600 text-white font-medium" onclick="selectDate(this)">1</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">2</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">3</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">4</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">5</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">6</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">7</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">8</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">9</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">10</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">11</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">12</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">13</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">14</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">15</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">16</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">17</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">18</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">19</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">20</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">21</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">22</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">23</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">24</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">25</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">26</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">27</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">28</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">29</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">30</button>
                 <button class="h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">31</button>
                 <!-- Next month dates -->
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">1</button>
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">2</button>
                 <button class="h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg" onclick="selectDate(this)">3</button>
             </div>
         </div>
     </div>
 </div>
 
 <!-- Time Picker Popup -->
 <div id="timePickerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
     <div class="bg-white rounded-lg shadow-xl w-full max-w-xs mx-4">
         <!-- Time Picker Header -->
         <div class="p-4 border-b">
             <div class="flex items-center justify-center space-x-2">
                 <span id="timeDisplay" class="text-blue-600 font-medium border-b border-blue-600 cursor-pointer" onclick="switchTimeType('start')">4:30pm</span>
                 <span class="text-gray-400">-</span>
                 <span id="otherTimeDisplay" class="px-2 py-1 bg-gray-100 rounded text-gray-700 cursor-pointer" onclick="switchTimeType('end')">5:30pm</span>
             </div>
         </div>
            
         <!-- Time List -->
         <div class="max-h-64 overflow-y-auto">
             <div id="timeList" class="p-2 space-y-1">
                 <!-- Time options will be generated here -->
             </div>
         </div>
     </div>
 </div>
 
 <script>
// Global variables to track calendar dates
let currentCalendarDate = new Date(2025, 9, 1); // October 2025 - Main calendar & modal
let sidebarCalendarDate = new Date(2025, 9, 1); // Sidebar mini calendar (independent when using its arrows)
 
 function openCreateModal() {
    const overlay = document.getElementById('createModal');
    overlay.classList.remove('hidden');
    const card = document.getElementById('createModalCard');
    if (card) {
        // Try to restore saved position if available
        const saved = JSON.parse(localStorage.getItem('createModalPos') || 'null');
        if (saved && typeof saved.left === 'number' && typeof saved.top === 'number') {
            card.style.position = 'absolute';
            card.style.left = `${saved.left}px`;
            card.style.top = `${saved.top}px`;
            card.style.transform = 'none';
        } else {
            // Default center
            card.style.position = '';
            card.style.left = '';
            card.style.top = '';
            card.style.transform = '';
        }
    }
 }
 
 function closeCreateModal() {
    const overlay = document.getElementById('createModal');
    overlay.classList.add('hidden');
    overlay.classList.remove('dragging');
 }
 
 let currentTimeType = 'start'; // Track which time button was clicked
 
 function toggleTimePicker(type = 'date') {
     if (type === 'date') {
         document.getElementById('datePickerModal').classList.remove('hidden');
     } else {
         currentTimeType = type;
         renderTimePicker();
         document.getElementById('timePickerModal').classList.remove('hidden');
     }
 }
 
 function closeDatePickerModal() {
     document.getElementById('datePickerModal').classList.add('hidden');
 }
 
 function closeTimePickerModal() {
     document.getElementById('timePickerModal').classList.add('hidden');
 }
 
 function renderTimePicker() {
     const timeList = document.getElementById('timeList');
     timeList.innerHTML = '';
     
     // Get current time values
     const startTimeBtn = document.getElementById('startTimeBtn');
     const endTimeBtn = document.getElementById('endTimeBtn');
     const currentTime = currentTimeType === 'start' ? startTimeBtn.textContent : endTimeBtn.textContent;
     
     // Update header display to show both times
     const timeDisplay = document.getElementById('timeDisplay');
     const otherTimeDisplay = document.getElementById('otherTimeDisplay');
     
     if (currentTimeType === 'start') {
         timeDisplay.textContent = currentTime;
         otherTimeDisplay.textContent = endTimeBtn.textContent;
         // Update styling to show which is active
         timeDisplay.className = 'text-blue-600 font-medium border-b border-blue-600 cursor-pointer';
         otherTimeDisplay.className = 'px-2 py-1 bg-gray-100 rounded text-gray-700 cursor-pointer';
     } else {
         timeDisplay.textContent = startTimeBtn.textContent;
         otherTimeDisplay.textContent = currentTime;
         // Update styling to show which is active
         timeDisplay.className = 'px-2 py-1 bg-gray-100 rounded text-gray-700 cursor-pointer';
         otherTimeDisplay.className = 'text-blue-600 font-medium border-b border-blue-600 cursor-pointer';
     }
     
     // Generate time options (15-minute intervals from 6:00am to 11:45pm)
     for (let hour = 6; hour <= 23; hour++) {
         for (let minute = 0; minute < 60; minute += 15) {
             const timeString = formatTime(hour, minute);
             const timeOption = document.createElement('div');
             timeOption.className = `px-3 py-2 text-sm cursor-pointer hover:bg-gray-100 rounded ${currentTime === timeString ? 'bg-gray-100' : ''}`;
             timeOption.textContent = timeString;
             timeOption.onclick = () => selectTime(timeString);
             timeList.appendChild(timeOption);
         }
     }
 }
 
 function formatTime(hour, minute) {
     const period = hour >= 12 ? 'pm' : 'am';
     const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour;
     const displayMinute = minute.toString().padStart(2, '0');
     return `${displayHour}:${displayMinute}${period}`;
 }
 
 function selectTime(timeString) {
     if (currentTimeType === 'start') {
         document.getElementById('startTimeBtn').textContent = timeString;
     } else {
         document.getElementById('endTimeBtn').textContent = timeString;
     }
     closeTimePickerModal();
 }
 
 function switchTimeType(type) {
     currentTimeType = type;
     renderTimePicker();
 }
 
 // Edit functions for all clickable elements
 function editTimeZone() {
     const currentValue = document.querySelector('button[onclick="editTimeZone()"]').textContent;
     const newValue = prompt('Enter time zone:', currentValue);
     if (newValue !== null && newValue.trim() !== '') {
         document.querySelector('button[onclick="editTimeZone()"]').textContent = newValue.trim();
     }
 }
 
 function toggleRepeatDropdown() {
     const dropdown = document.getElementById('repeatDropdown');
     dropdown.classList.toggle('hidden');
 }
 
 function selectRepeatOption(option) {
     document.getElementById('repeatButton').textContent = option;
     document.getElementById('repeatDropdown').classList.add('hidden');
 }
 
 function editLocation() {
     const locationText = document.getElementById('locationText');
     const locationInput = document.getElementById('locationInput');
     
     if (locationInput.classList.contains('hidden')) {
         // Show input, hide text
         locationText.classList.add('hidden');
         locationInput.classList.remove('hidden');
         locationInput.focus();
         locationInput.value = locationText.textContent === 'Add location' ? '' : locationText.textContent;
     } else {
         // Save and hide input, show text
         if (locationInput.value.trim() !== '') {
             locationText.textContent = locationInput.value.trim();
             locationText.className = 'text-gray-800';
         } else {
             locationText.textContent = 'Add location';
             locationText.className = '';
         }
         locationInput.classList.add('hidden');
         locationText.classList.remove('hidden');
     }
 }
 
 function editDescription() {
     const descriptionText = document.getElementById('descriptionText');
     const descriptionInput = document.getElementById('descriptionInput');
     
     if (descriptionInput.classList.contains('hidden')) {
         // Show input, hide text
         descriptionText.classList.add('hidden');
         descriptionInput.classList.remove('hidden');
         descriptionInput.focus();
         descriptionInput.value = descriptionText.textContent === 'Add description or a Google Drive attachment' ? '' : descriptionText.textContent;
     } else {
         // Save and hide input, show text
         if (descriptionInput.value.trim() !== '') {
             descriptionText.textContent = descriptionInput.value.trim();
             descriptionText.className = 'text-gray-800';
         } else {
             descriptionText.textContent = 'Add description or a Google Drive attachment';
             descriptionText.className = '';
         }
         descriptionInput.classList.add('hidden');
         descriptionText.classList.remove('hidden');
     }
 }
 
 function editMoreOptions() {
     const options = prompt('Enter additional options (visibility, notifications, etc.):');
     if (options !== null && options.trim() !== '') {
         console.log('More options set to:', options.trim());
         alert('Options saved: ' + options.trim());
     }
 }
 
 // Global events storage - load from local storage or initialize empty array
 let events = JSON.parse(localStorage.getItem('calendarEvents') || '[]');

// Track which event is currently shown in the details modal
let currentOpenedEventId = null;
let isEditingExisting = false;

// Make saveEvent globally accessible
window.saveEvent = function() {
     console.log('Save button clicked!'); // Debug log
     
     try {
        const title = document.getElementById('eventTitle').value;
         console.log('Title:', title); // Debug log
         
         const startTime = document.getElementById('startTimeBtn').textContent;
         const endTime = document.getElementById('endTimeBtn').textContent;
         const date = document.querySelector('button[onclick="toggleTimePicker()"]').textContent;
        const location = document.getElementById('locationText').textContent;
         const description = document.getElementById('descriptionText').textContent;
        const eventType = (document.getElementById('eventTypeSelect') && document.getElementById('eventTypeSelect').value) || 'Event';
         
        console.log('Form data:', { title, startTime, endTime, date, location, description, eventType }); // Debug log
         
         if (!title.trim()) {
             alert('Please enter a title for the event');
             return;
         }
         
         // Get selected color from color picker button
         const colorButton = document.querySelector('button[onclick="toggleColorPicker()"]');
         console.log('Color button found:', colorButton); // Debug log
         
         let selectedColor = 'bg-blue-500'; // Default color
         if (colorButton) {
             const colorClass = colorButton.className.match(/bg-\w+-\d+|bg-transparent/);
             selectedColor = colorClass ? colorClass[0] : 'bg-blue-500';
         }
         console.log('Selected color:', selectedColor); // Debug log
         
         // Extract date number from the date string (e.g., "Wednesday, 1 October" -> "1")
         const dateNumber = date.match(/\d+/);
         const dayNumber = dateNumber ? dateNumber[0] : '1';
         console.log('Day number:', dayNumber); // Debug log
         
        // Create or update event object
        let eventData;
        if (isEditingExisting && currentOpenedEventId) {
            const idx = events.findIndex(ev => String(ev.id) === String(currentOpenedEventId));
            if (idx !== -1) {
                events[idx] = {
                    ...events[idx],
                    title: title.trim(),
                    date: date,
                    dayNumber: parseInt(dayNumber),
                    startTime: startTime,
                    endTime: endTime,
                    location: location !== 'Add location' ? location : '',
                    description: description !== 'Add description or a Google Drive attachment' ? description : '',
                    color: selectedColor,
                    type: eventType
                };
                eventData = events[idx];
            }
        }
        if (!eventData) {
            eventData = {
                id: Date.now(), // Unique ID
                title: title.trim(),
                date: date,
                dayNumber: parseInt(dayNumber),
                startTime: startTime,
                endTime: endTime,
                location: location !== 'Add location' ? location : '',
                description: description !== 'Add description or a Google Drive attachment' ? description : '',
                color: selectedColor,
                type: eventType
            };
            // Add event to storage
            events.push(eventData);
        }
         
         console.log('Event data created:', eventData); // Debug log
         
        console.log('Events array:', events); // Debug log
         
        // Save to local storage so events persist after refresh
         localStorage.setItem('calendarEvents', JSON.stringify(events));
         console.log('Events saved to local storage'); // Debug log
         
         // Update calendar display
         renderEventsOnCalendar();
        renderMyEvents();
         console.log('Calendar rendered'); // Debug log
         
        // Close modal automatically - no popup alert
         closeCreateModal();
        isEditingExisting = false;
         
     } catch (error) {
         console.error('Error in saveEvent:', error);
         alert('Error saving event: ' + error.message);
     }
 };
 
 function nextMonth() {
     currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
    renderCalendar();
    renderEventsOnCalendar();
    // Keep sidebar in sync with main when main changes
    sidebarCalendarDate = new Date(currentCalendarDate.getTime());
    renderSidebarCalendar();
 }
 
function renderEventsOnCalendar() {
   // Clear existing events from the main calendar only
   document.querySelectorAll('#mainCalendarGrid .event-bar').forEach(event => event.remove());
   
   // Main calendar day cells (contain a <span> with the day number)
   const mainDayCells = document.querySelectorAll('#mainCalendarGrid > div');
   
   // Only render events for the currently displayed month/year
   const displayMonth = currentCalendarDate.getMonth();
   const displayYear = currentCalendarDate.getFullYear();
   const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
     
   // Add events to their respective days (filtered by month/year)
   events.forEach(event => {
       // Determine event month/year from stored fields or parse from date string
       let eventMonth = typeof event.month === 'number' ? event.month : null;
       let eventYear = typeof event.year === 'number' ? event.year : null;
       if (eventMonth === null) {
           const parsedMonthIndex = monthNames.findIndex(name => (event.date || '').includes(name));
           eventMonth = parsedMonthIndex !== -1 ? parsedMonthIndex : displayMonth;
       }
       if (eventYear === null) {
           const yearMatch = (event.date || '').match(/\b(19|20)\d{2}\b/);
           eventYear = yearMatch ? parseInt(yearMatch[0]) : displayYear;
       }
       // Skip events not in the currently displayed month/year
       if (eventMonth !== displayMonth || eventYear !== displayYear) {
           return;
       }

       // Render in main calendar grid only
       mainDayCells.forEach(cell => {
           const span = cell.querySelector('span');
           if (cell.dataset && cell.dataset.monthType === 'current' && span && span.textContent.trim() === event.dayNumber.toString()) {
               // Create a container for events stacked under the date number
               let eventContainer = cell.querySelector('.events-container');
               if (!eventContainer) {
                   eventContainer = document.createElement('div');
                   eventContainer.className = 'events-container w-full mt-1 space-y-1 pr-1 mx-auto flex-grow flex flex-col justify-start';
                   // Allow clicks on event elements
                   eventContainer.style.pointerEvents = 'auto';
                   cell.appendChild(eventContainer);
               }
               const eventBar = document.createElement('div');
               eventBar.className = `event-bar ${event.color} text-white text-xs px-2 py-1 rounded font-medium truncate cursor-pointer relative z-10`;
               eventBar.textContent = event.title;
               eventBar.style.fontSize = '12px';
               eventBar.style.lineHeight = '1.2';
               eventBar.style.maxWidth = '100%';
               eventBar.dataset.eventId = String(event.id);
               // Direct click handler as well for reliability
               eventBar.addEventListener('click', (ev) => {
                   ev.stopPropagation();
                   openEventDetail(event);
               });
               eventContainer.appendChild(eventBar);
           }
       });
   });
}
// Also keep sidebar list in sync whenever we render
try { renderMyEvents(); } catch (_) {}

// Render sidebar My Events list
function renderMyEvents() {
    const list = document.getElementById('myEventsList');
    if (!list) return;
    list.innerHTML = '';
    if (!events || events.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'text-gray-500 text-xs';
        empty.textContent = 'No events yet';
        list.appendChild(empty);
        return;
    }
    // Sort by date then time
    const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    const toDate = (ev) => {
        const text = ev.date || '';
        const yearMatch = text.match(/\b(19|20)\d{2}\b/);
        const monthIndex = monthNames.findIndex(n => text.includes(n));
        const dayMatch = text.match(/\b\d{1,2}\b/);
        const y = yearMatch ? parseInt(yearMatch[0]) : currentCalendarDate.getFullYear();
        const m = monthIndex !== -1 ? monthIndex : currentCalendarDate.getMonth();
        const d = dayMatch ? parseInt(dayMatch[0]) : ev.dayNumber || 1;
        return new Date(y, m, d);
    };
    	const sorted = [...events].sort((a,b) => toDate(a) - toDate(b));
		// Helper to format date like "Oct 1, 2025"
					sorted.forEach(ev => {
				const row = document.createElement('div');
				row.className = 'group flex items-center justify-between rounded-lg px-2 py-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800/60';

				const title = document.createElement('div');
				title.className = 'text-[13px] font-semibold text-text-light dark:text-text-dark truncate';
				title.textContent = ev.title || 'Untitled Event';

				const menu = document.createElement('button');
				menu.type = 'button';
				menu.className = 'ml-3 shrink-0 text-text-muted-light dark:text-text-muted-dark opacity-0 group-hover:opacity-100 transition-opacity';
				menu.innerHTML = '<span class="material-symbols-outlined text-[18px]">more_horiz</span>';

				row.appendChild(title);
				row.appendChild(menu);

				// Open details when clicking anywhere except the menu icon
				row.addEventListener('click', (e) => {
					if (!(e.target.closest && e.target.closest('button'))) {
						openEventDetail(ev);
					}
				});
				list.appendChild(row);
			});
}

function setView(viewName) {
    const btn = document.getElementById('viewBtnLabel');
    const dropdown = document.getElementById('viewDropdown');
    if (btn) btn.textContent = viewName;
    if (dropdown) dropdown.classList.add('hidden');
    const dayContainer = document.getElementById('dayCalendarContainer');
    const weekContainer = document.getElementById('weekCalendarContainer');
    const mainGrid = document.getElementById('mainCalendarGrid');
    if (dayContainer) dayContainer.classList.add('hidden');
    if (weekContainer) weekContainer.classList.add('hidden');
    if (mainGrid) mainGrid.innerHTML = '';
    if (viewName === 'Month') {
        renderCalendar();
        renderEventsOnCalendar();
    } else if (viewName === 'Day') {
        if (dayContainer) dayContainer.classList.remove('hidden');
        renderDayView(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), 1));
    } else if (viewName === 'Week') {
        if (weekContainer) weekContainer.classList.remove('hidden');
        renderWeekView(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), 1));
    }
}

// Render Day view for a specific date
function renderDayView(dateObj) {
    const container = document.getElementById('dayCalendarContainer');
    const hoursGrid = document.getElementById('dayHoursGrid');
    if (!container || !hoursGrid) return;
    hoursGrid.innerHTML = '';

    // Update header weekday and date
    const dow = ['SUN','MON','TUE','WED','THU','FRI','SAT'][dateObj.getDay()];
    const dayNum = dateObj.getDate();
    const dowEl = document.getElementById('dayHeaderDow');
    const dateEl = document.getElementById('dayHeaderDate');
    if (dowEl) dowEl.textContent = dow;
    if (dateEl) dateEl.textContent = String(dayNum);

    // Build 24 rows (1AM..12AM)
    for (let h = 0; h < 24; h++) {
        const label = document.createElement('div');
        label.className = 'text-[11px] text-gray-500 px-2 py-3 border-b border-border-light dark:border-border-dark';
        const displayHour = ((h + 11) % 12) + 1; // 0->12, 13->1
        const ampm = h < 12 ? 'AM' : 'PM';
        label.textContent = `${displayHour} ${ampm}`;

        const slot = document.createElement('div');
        slot.className = 'relative h-12 border-b border-border-light dark:border-border-dark';
        hoursGrid.appendChild(label);
        hoursGrid.appendChild(slot);
    }

    // Render events that match this specific date
    const day = dateObj.getDate();
    const month = dateObj.getMonth();
    const year = dateObj.getFullYear();

    const dayEvents = events.filter(ev => {
        const text = ev.date || '';
        const yearMatch = text.match(/\b(19|20)\d{2}\b/);
        const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const monthIndex = monthNames.findIndex(n => text.includes(n));
        const dayMatch = text.match(/\b\d{1,2}\b/);
        const evYear = yearMatch ? parseInt(yearMatch[0]) : year;
        const evMonth = monthIndex !== -1 ? monthIndex : month;
        const evDay = dayMatch ? parseInt(dayMatch[0]) : ev.dayNumber || day;
        return evYear === year && evMonth === month && evDay === day;
    });

    // Place as simple blocks at approximate hour positions using startTime
    dayEvents.forEach(ev => {
        const time = (ev.startTime || '9:00am').toLowerCase();
        const match = time.match(/(\d{1,2}):(\d{2})(am|pm)/);
        let hourIndex = 9;
        if (match) {
            let hour = parseInt(match[1]);
            const minute = parseInt(match[2]);
            const meridiem = match[3];
            if (meridiem === 'pm' && hour !== 12) hour += 12;
            if (meridiem === 'am' && hour === 12) hour = 0;
            hourIndex = hour;
            // We have 24 rows where each row corresponds to an hour, 0..23
        }
        const targetSlot = hoursGrid.children[hourIndex * 2 + 1];
        if (!targetSlot) return;
        const block = document.createElement('div');
        block.className = `${ev.color || 'bg-blue-500'} text-white text-xs px-2 py-1 rounded absolute left-2 right-2 top-1`;
        block.textContent = ev.title;
        targetSlot.appendChild(block);
    });
}
 
// Render Week view for a given date (week of the 1st day's week)
function renderWeekView(dateObj) {
    const weekHeader = document.getElementById('weekHeader');
    const weekGrid = document.getElementById('weekGrid');
    if (!weekHeader || !weekGrid) return;
    weekHeader.innerHTML = '';
    weekGrid.innerHTML = '';

    // Determine start of week (Sunday)
    const ref = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
    const start = new Date(ref);
    start.setDate(ref.getDate() - ref.getDay());

    const dayNames = ['SUN','MON','TUE','WED','THU','FRI','SAT'];

    // Header row: empty corner + 7 days
    const corner = document.createElement('div');
    corner.className = 'p-3 text-[11px] text-gray-500';
    corner.textContent = 'GMT+08';
    weekHeader.appendChild(corner);
    for (let i = 0; i < 7; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);
        const head = document.createElement('div');
        head.className = 'p-3 border-l border-border-light dark:border-border-dark';
        head.innerHTML = `<div class="text-[11px] text-gray-500 text-center">${dayNames[d.getDay()]}</div><div class="text-2xl font-semibold text-gray-800 dark:text-gray-100 text-center">${d.getDate()}</div>`;
        weekHeader.appendChild(head);
    }

    // Left time labels column + 7 columns each with 24 slots
    for (let h = 0; h < 24; h++) {
        const label = document.createElement('div');
        label.className = 'text-[11px] text-gray-500 px-2 py-3 border-b border-border-light dark:border-border-dark';
        const displayHour = ((h + 11) % 12) + 1;
        const ampm = h < 12 ? 'AM' : 'PM';
        label.textContent = `${displayHour} ${ampm}`;
        weekGrid.appendChild(label);
        for (let i = 0; i < 7; i++) {
            const cell = document.createElement('div');
            cell.className = 'relative h-12 border-l border-b border-border-light dark:border-border-dark';
            weekGrid.appendChild(cell);
        }
    }

    // Place events in appropriate day column and hour
    const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    const toYMD = (ev) => {
        const text = ev.date || '';
        const yMatch = text.match(/\b(19|20)\d{2}\b/);
        const mIndex = monthNames.findIndex(n => text.includes(n));
        const dMatch = text.match(/\b\d{1,2}\b/);
        const y = yMatch ? parseInt(yMatch[0]) : currentCalendarDate.getFullYear();
        const m = mIndex !== -1 ? mIndex : currentCalendarDate.getMonth();
        const d = dMatch ? parseInt(dMatch[0]) : ev.dayNumber || 1;
        return { y, m, d };
    };

    events.forEach(ev => {
        const { y, m, d } = toYMD(ev);
        const evDate = new Date(y, m, d);
        // Only show events within this week range
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        if (evDate < start || evDate > end) return;

        // Compute target column offset: +1 for time labels column, +h*8 stride
        const dayOffset = Math.floor((evDate - start) / 86400000); // 0..6
        const time = (ev.startTime || '9:00am').toLowerCase();
        const match = time.match(/(\d{1,2}):(\d{2})(am|pm)/);
        let hourIndex = 9;
        if (match) {
            let hour = parseInt(match[1]);
            const minute = parseInt(match[2]);
            const meridiem = match[3];
            if (meridiem === 'pm' && hour !== 12) hour += 12;
            if (meridiem === 'am' && hour === 12) hour = 0;
            hourIndex = hour;
        }
        // In the weekGrid, each row adds 8 columns (1 label + 7 days). Target cell index:
        const rowStartIndex = hourIndex * 8; // 8 columns per hour row
        const cellIndex = rowStartIndex + 1 + dayOffset; // +1 to skip label column
        const cell = weekGrid.children[cellIndex];
        if (!cell) return;
        const block = document.createElement('div');
        block.className = `${ev.color || 'bg-blue-500'} text-white text-xs px-2 py-1 rounded absolute left-2 right-2 top-1 cursor-pointer`;
        block.textContent = ev.title;
        block.dataset.eventId = String(ev.id);
        block.addEventListener('click', (e) => {
            e.stopPropagation();
            openEventDetail(ev);
        });
        cell.appendChild(block);
    });
}

function openEventDetail(event) {
    const modal = document.getElementById('eventDetailModal');
    if (!modal) { console.error('eventDetailModal not found'); return; }
    currentOpenedEventId = event && event.id ? event.id : null;
    document.getElementById('detailTitle').textContent = event.title || 'Event';
    document.getElementById('detailLocation').textContent = event.location || '';
    document.getElementById('detailOrganizer').textContent = 'Chrisjane Patricio';
    document.getElementById('detailReminder').textContent = 'The day before at 5pm';
    const colorDot = document.getElementById('detailColorDot');
    colorDot.className = `w-3.5 h-3.5 rounded-full ${event.color || 'bg-blue-500'}`;
    
    // Compose readable date from stored date string if available
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    let dateText = event.date;
    if (!dateText && typeof event.dayNumber === 'number') {
        const d = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), event.dayNumber);
        const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        dateText = `${dayNames[d.getDay()]}, ${event.dayNumber} ${monthNames[d.getMonth()]}`;
    }
    document.getElementById('detailDate').textContent = dateText || '';

    	// Ensure container centers content and resets any prior inline offsets
	const card = document.querySelector('#eventDetailModal > div');
	if (card) { card.style.marginTop = '0px'; }
	modal.classList.remove('hidden');
	modal.classList.add('flex');
    modal.style.display = 'flex';
}

 function prevMonth() {
     currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
    renderCalendar();
    renderEventsOnCalendar();
    // Keep sidebar in sync with main when main changes
    sidebarCalendarDate = new Date(currentCalendarDate.getTime());
    renderSidebarCalendar();
 }
 
 function renderCalendar() {
     const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
     const currentMonth = currentCalendarDate.getMonth();
     const currentYear = currentCalendarDate.getFullYear();
     
    // Update month display
    document.getElementById('currentMonthDisplay').textContent = `${monthNames[currentMonth]} ${currentYear}`;
    const sidebarMonthEl = document.getElementById('sidebarMonthDisplay');
    if (sidebarMonthEl) sidebarMonthEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
    const mainMonthEl = document.getElementById('mainMonthDisplay');
    if (mainMonthEl) mainMonthEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
     
   // Clear small calendar grid (date picker modal)
   const calendarGrid = document.getElementById('calendarGrid');
   calendarGrid.innerHTML = '';
   // Do not touch sidebar mini grid here; it's rendered separately
     
     // Clear main calendar grid
     const mainCalendarGrid = document.getElementById('mainCalendarGrid');
     mainCalendarGrid.innerHTML = '';
    // Ensure day view is hidden when rendering month grid
    const dayContainer = document.getElementById('dayCalendarContainer');
    if (dayContainer) dayContainer.classList.add('hidden');
     
     // Add day headers to main calendar
     const dayHeaders = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
     dayHeaders.forEach(day => {
         const headerDiv = document.createElement('div');
         headerDiv.className = 'text-center py-2 border-r border-b border-border-light dark:border-border-dark text-sm font-semibold text-muted-light dark:text-muted-dark';
         headerDiv.textContent = day;
         mainCalendarGrid.appendChild(headerDiv);
     });
     
     // Get first day of month and number of days
     const firstDay = new Date(currentYear, currentMonth, 1);
     const lastDay = new Date(currentYear, currentMonth + 1, 0);
     const daysInMonth = lastDay.getDate();
     const startingDayOfWeek = firstDay.getDay();
     
     // Previous month days
     const prevMonth = new Date(currentYear, currentMonth - 1, 0);
     const daysInPrevMonth = prevMonth.getDate();
     
    // Add previous month days
     for (let i = startingDayOfWeek - 1; i >= 0; i--) {
         const day = daysInPrevMonth - i;
         
         // Small calendar button
         const button = document.createElement('button');
         button.className = 'h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
         button.textContent = day;
        button.dataset.monthType = 'prev';
         button.onclick = () => selectDate(button);
       calendarGrid.appendChild(button);
         
        // Main calendar cell
        const cellDiv = document.createElement('div');
        cellDiv.className = 'h-28 border-r border-b border-border-light dark:border-border-dark flex flex-col items-start pt-2 px-1 text-muted-light dark:text-muted-dark overflow-hidden';
        cellDiv.innerHTML = `<span class="text-xs mx-auto">${day}</span>`;
        cellDiv.dataset.monthType = 'prev';
         mainCalendarGrid.appendChild(cellDiv);
     }
     
     // Current month days
     const today = new Date();
     for (let day = 1; day <= daysInMonth; day++) {
        // Small calendar button
         const button = document.createElement('button');
         button.className = 'h-10 text-center text-sm hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
         button.textContent = day;
        button.dataset.monthType = 'current';
         button.onclick = () => selectDate(button);
       calendarGrid.appendChild(button);
         
        // Main calendar cell
        const cellDiv = document.createElement('div');
         const isToday = today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear;
         
        // Use consistent structure for all dates to ensure proper event alignment
        cellDiv.className = 'h-28 border-r border-b border-border-light dark:border-border-dark flex flex-col items-start pt-2 px-1 overflow-hidden';
        
        if (isToday) {
           cellDiv.innerHTML = `
             <div class="relative w-full flex justify-center mb-1">
               <span class="bg-blue-600 text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-xs leading-none relative z-10">${day}</span>
             </div>
           `;
         } else {
           cellDiv.innerHTML = `
             <div class="relative w-full flex justify-center mb-1">
               <span class="text-xs mx-auto w-6 h-6 inline-flex items-center justify-center">${day}</span>
             </div>
           `;
         }
        cellDiv.dataset.monthType = 'current';
         mainCalendarGrid.appendChild(cellDiv);
     }
     
     // Next month days to fill the grid
     const remainingCells = 42 - (startingDayOfWeek + daysInMonth); // 6 rows * 7 days
     for (let day = 1; day <= remainingCells; day++) {
        // Small calendar button
         const button = document.createElement('button');
         button.className = 'h-10 text-center text-sm text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
         button.textContent = day;
        button.dataset.monthType = 'next';
         button.onclick = () => selectDate(button);
       calendarGrid.appendChild(button);
         
        // Main calendar cell
        const cellDiv = document.createElement('div');
        cellDiv.className = 'h-28 border-r border-b border-border-light dark:border-border-dark flex flex-col items-start pt-2 px-1 text-muted-light dark:text-muted-dark overflow-hidden';
        cellDiv.innerHTML = `<span class="text-xs mx-auto">${day}</span>`;
        cellDiv.dataset.monthType = 'next';
         mainCalendarGrid.appendChild(cellDiv);
     }
 }

// Render the sidebar mini calendar independently with clickable days
function renderSidebarCalendar() {
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const currentMonth = sidebarCalendarDate.getMonth();
    const currentYear = sidebarCalendarDate.getFullYear();
    const sidebarMonthEl = document.getElementById('sidebarMonthDisplay');
    if (sidebarMonthEl) sidebarMonthEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;

    const grid = document.getElementById('sidebarCalendarGrid');
    if (!grid) return;
    grid.innerHTML = '';

    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();

    const prevMonth = new Date(currentYear, currentMonth - 1, 0);
    const daysInPrevMonth = prevMonth.getDate();

    // Previous month spillover
    for (let i = startingDayOfWeek - 1; i >= 0; i--) {
        const day = daysInPrevMonth - i;
        const button = document.createElement('button');
        button.className = 'h-8 text-center text-[12px] text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
        button.textContent = day;
        button.dataset.monthType = 'prev';
        button.onclick = () => selectDate(button);
        grid.appendChild(button);
    }

    // Current month
    for (let day = 1; day <= daysInMonth; day++) {
        const button = document.createElement('button');
        button.className = 'h-8 text-center text-[12px] hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
        button.textContent = day;
        button.dataset.monthType = 'current';
        button.onclick = () => selectDate(button);
        grid.appendChild(button);
    }

    // Next month spillover to fill 6 rows
    const remainingCells = 42 - (startingDayOfWeek + daysInMonth);
    for (let day = 1; day <= remainingCells; day++) {
        const button = document.createElement('button');
        button.className = 'h-8 text-center text-[12px] text-gray-400 dark:text-gray-500 hover:bg-gray-800 dark:hover:bg-gray-200 hover:text-white dark:hover:text-gray-800 rounded-lg';
        button.textContent = day;
        button.dataset.monthType = 'next';
        button.onclick = () => selectDate(button);
        grid.appendChild(button);
    }
}
 
 function selectDate(dateElement) {
     const dateText = dateElement.textContent;
     const selectedDate = parseInt(dateText);
     
     // Update the date button text
     const dateButton = document.querySelector('button[onclick="toggleTimePicker()"]');
    if (dateButton) {
         const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
         const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
         
         // Use the current calendar date to get the correct month and year
         const currentMonth = currentCalendarDate.getMonth();
         const currentYear = currentCalendarDate.getFullYear();
         const date = new Date(currentYear, currentMonth, selectedDate);
         
         const dayName = dayNames[date.getDay()];
         const monthName = monthNames[date.getMonth()];
        
        // Include year so events can be accurately scoped across months/years
        dateButton.textContent = `${dayName}, ${selectedDate} ${monthName} ${currentYear}`;
     }
     
    // Close the modal
    closeDatePickerModal();

       // Show selected date in the currently chosen view (Day or Week)
    const mainGrid = document.getElementById('mainCalendarGrid');
    const dayContainer = document.getElementById('dayCalendarContainer');
    const weekContainer = document.getElementById('weekCalendarContainer');
    const viewLabel = document.getElementById('viewBtnLabel');
    const isWeek = viewLabel && viewLabel.textContent.trim() === 'Week';
    if (mainGrid) mainGrid.innerHTML = '';
    if (isWeek) {
        if (dayContainer) dayContainer.classList.add('hidden');
        if (weekContainer) weekContainer.classList.remove('hidden');
        renderWeekView(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), selectedDate));
    } else {
        if (weekContainer) weekContainer.classList.add('hidden');
        if (dayContainer) dayContainer.classList.remove('hidden');
        renderDayView(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), selectedDate));
        if (viewLabel) viewLabel.textContent = 'Day';
    }
}
 
 // Close modal when clicking outside
 document.getElementById('createModal').addEventListener('click', function(e) {
     if (e.target === this) {
         closeCreateModal();
     }
 });
 
 // Close date picker modal when clicking outside
 document.getElementById('datePickerModal').addEventListener('click', function(e) {
     if (e.target === this) {
         closeDatePickerModal();
     }
 });
 
 // Close time picker modal when clicking outside
 document.getElementById('timePickerModal').addEventListener('click', function(e) {
     if (e.target === this) {
         closeTimePickerModal();
     }
 });
 
 // Add event listeners for input fields
 document.addEventListener('DOMContentLoaded', function() {
     // Location input events
     document.getElementById('locationInput').addEventListener('keypress', function(e) {
         if (e.key === 'Enter') {
             editLocation();
         }
     });
     document.getElementById('locationInput').addEventListener('blur', function() {
         editLocation();
     });
     
     // Description input events
     document.getElementById('descriptionInput').addEventListener('keypress', function(e) {
         if (e.key === 'Enter') {
             editDescription();
         }
     });
     document.getElementById('descriptionInput').addEventListener('blur', function() {
         editDescription();
     });
     
     // Close repeat dropdown when clicking outside
     document.addEventListener('click', function(e) {
         const repeatDropdown = document.getElementById('repeatDropdown');
         const repeatButton = document.getElementById('repeatButton');
         if (!repeatDropdown.contains(e.target) && !repeatButton.contains(e.target)) {
             repeatDropdown.classList.add('hidden');
         }
         
     // Close color picker when clicking outside
     const colorPicker = document.getElementById('colorPicker');
     const colorButton = document.querySelector('button[onclick="toggleColorPicker()"]');
     if (colorPicker && colorButton && !colorPicker.contains(e.target) && !colorButton.contains(e.target)) {
         colorPicker.classList.add('hidden');
     }
     
     // Close notification dropdown when clicking outside
     const notificationDropdown = document.getElementById('notificationDropdown');
     const notificationButton = document.querySelector('div[onclick="toggleNotificationDropdown()"]');
     if (notificationDropdown && notificationButton && !notificationDropdown.contains(e.target) && !notificationButton.contains(e.target)) {
         notificationDropdown.classList.add('hidden');
     }
     });
     
    // Hook up main and sidebar navigation buttons
    const mainPrevBtn = document.getElementById('mainPrevBtn');
    const mainNextBtn = document.getElementById('mainNextBtn');
    if (mainPrevBtn) mainPrevBtn.addEventListener('click', prevMonth);
    if (mainNextBtn) mainNextBtn.addEventListener('click', nextMonth);
   const sidebarPrevBtn = document.getElementById('sidebarPrevBtn');
   const sidebarNextBtn = document.getElementById('sidebarNextBtn');
   // Sidebar arrows advance only the sidebar mini calendar
   function sidebarPrevMonth() {
       sidebarCalendarDate.setMonth(sidebarCalendarDate.getMonth() - 1);
       renderSidebarCalendar();
   }
   function sidebarNextMonth() {
       sidebarCalendarDate.setMonth(sidebarCalendarDate.getMonth() + 1);
       renderSidebarCalendar();
   }
   if (sidebarPrevBtn) sidebarPrevBtn.addEventListener('click', sidebarPrevMonth);
   if (sidebarNextBtn) sidebarNextBtn.addEventListener('click', sidebarNextMonth);

    // Today button behavior: jump to current month and sync sidebar
    const todayBtn = document.getElementById('todayBtn');
    const viewSelect = document.getElementById('viewSelect');
    if (todayBtn) todayBtn.addEventListener('click', function() {
        const now = new Date();
        currentCalendarDate = new Date(now.getFullYear(), now.getMonth(), 1);
        renderCalendar();
        renderEventsOnCalendar();
        sidebarCalendarDate = new Date(currentCalendarDate.getTime());
        renderSidebarCalendar();
    });
    // Replace native select with custom dropdown handlers
    const viewBtn = document.getElementById('viewBtn');
    const viewDropdown = document.getElementById('viewDropdown');
    const viewLabel = document.getElementById('viewBtnLabel');
    if (viewBtn && viewDropdown) {
        viewBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            viewDropdown.classList.toggle('hidden');
        });
        viewDropdown.querySelectorAll('button[data-view]').forEach(btn => {
            btn.addEventListener('click', () => setView(btn.getAttribute('data-view')));
        });
        document.addEventListener('click', (e) => {
            if (!viewDropdown.contains(e.target) && !viewBtn.contains(e.target)) {
                viewDropdown.classList.add('hidden');
            }
        });
    }


    // Render the calendars
    renderCalendar();
    renderSidebarCalendar();
     
    // Load and render existing events when page loads
    renderEventsOnCalendar();
    renderMyEvents();
    renderMyEvents();

    // Draggable Create Modal
    const createOverlay = document.getElementById('createModal');
    const createHeader = document.getElementById('createModalHeader');
    const createCard = document.getElementById('createModalCard');
    if (createHeader && createCard && createOverlay) {
        let isDragging = false;
        let startX = 0, startY = 0, origLeft = 0, origTop = 0;

        function onMouseDown(e) {
            // Ignore drags starting from non-draggable controls
            const target = e.target;
            if (target.closest('[data-no-drag]') || target.closest('button') || target.closest('input') || target.closest('select') || target.closest('a')) {
                return;
            }
            isDragging = true;
            createOverlay.classList.add('dragging');
            const rect = createCard.getBoundingClientRect();
            // Switch to absolute positioned card anchored to viewport
            createCard.style.position = 'absolute';
            createCard.style.left = `${rect.left}px`;
            createCard.style.top = `${rect.top + window.scrollY}px`;
            createCard.style.transform = 'none';
            startX = e.clientX;
            startY = e.clientY;
            origLeft = rect.left;
            origTop = rect.top + window.scrollY;
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp, { once: true });
        }

        function onMouseMove(e) {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            let nextLeft = origLeft + dx;
            let nextTop = origTop + dy;
            // Constrain within viewport
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const cr = createCard.getBoundingClientRect();
            const width = cr.width;
            const height = cr.height;
            nextLeft = Math.max(8, Math.min(nextLeft, vw - width - 8));
            nextTop = Math.max(8 + window.scrollY, Math.min(nextTop, window.scrollY + vh - height - 8));
            createCard.style.left = `${nextLeft}px`;
            createCard.style.top = `${nextTop}px`;
        }

        function onMouseUp() {
            isDragging = false;
            createOverlay.classList.remove('dragging');
            document.removeEventListener('mousemove', onMouseMove);
            // Persist final position
            const rect = createCard.getBoundingClientRect();
            const saved = { left: rect.left, top: rect.top + window.scrollY };
            localStorage.setItem('createModalPos', JSON.stringify(saved));
        }

        createHeader.addEventListener('mousedown', onMouseDown);
    }

    // Event detail modal close and backdrop click
    const detailModal = document.getElementById('eventDetailModal');
    const detailCloseBtn = document.getElementById('detailCloseBtn');
    if (detailCloseBtn) detailCloseBtn.addEventListener('click', () => {
        detailModal.classList.add('hidden');
        detailModal.classList.remove('flex');
        detailModal.style.display = 'none';
    });
    // Edit current event -> open create modal prefilled
    const detailEditBtn = document.getElementById('detailEditBtn');
    if (detailEditBtn) detailEditBtn.addEventListener('click', () => {
        if (!currentOpenedEventId) return;
        const evt = events.find(ev => String(ev.id) === String(currentOpenedEventId));
        if (!evt) return;
        // Prefill fields
        document.getElementById('eventTitle').value = evt.title || '';
        const dateBtn = document.querySelector('button[onclick="toggleTimePicker()"]');
        if (dateBtn && evt.date) dateBtn.textContent = evt.date;
        if (evt.startTime) document.getElementById('startTimeBtn').textContent = evt.startTime;
        if (evt.endTime) document.getElementById('endTimeBtn').textContent = evt.endTime;
        const locationText = document.getElementById('locationText');
        locationText.textContent = evt.location ? evt.location : 'Add location';
        const descriptionText = document.getElementById('descriptionText');
        descriptionText.textContent = evt.description ? evt.description : 'Add description or a Google Drive attachment';
        // Color button
        const colorBtn = document.querySelector('button[onclick="toggleColorPicker()"]');
        if (colorBtn && evt.color) {
            colorBtn.className = colorBtn.className.replace(/bg-\w+-\d+|bg-transparent|border-2\sborder-\w+-\d+/g, '').trim();
            colorBtn.className += ` ${evt.color}`;
        }
        // Close detail modal, open create modal in edit mode
        detailModal.classList.add('hidden');
        detailModal.classList.remove('flex');
        detailModal.style.display = 'none';
        isEditingExisting = true;
        openCreateModal();
    });
    // Delete current event
    const detailDeleteBtn = document.getElementById('detailDeleteBtn');
    if (detailDeleteBtn) detailDeleteBtn.addEventListener('click', () => {
        if (currentOpenedEventId == null) return;
        // Remove from events array
        events = events.filter(ev => String(ev.id) !== String(currentOpenedEventId));
        // Persist
        localStorage.setItem('calendarEvents', JSON.stringify(events));
        // Re-render
        renderEventsOnCalendar();
        renderMyEvents();
        // Close modal
        detailModal.classList.add('hidden');
        detailModal.classList.remove('flex');
        detailModal.style.display = 'none';
        currentOpenedEventId = null;
    });
    if (detailModal) detailModal.addEventListener('click', (e) => {
        if (e.target === detailModal) {
            detailModal.classList.add('hidden');
            detailModal.classList.remove('flex');
            detailModal.style.display = 'none';
        }
    });

    // Event delegation for opening event details
    const grid = document.getElementById('mainCalendarGrid');
    grid.addEventListener('click', function(e) {
        const el = e.target.closest ? e.target.closest('.event-bar') : null;
        if (el) {
            const id = el.dataset.eventId;
            const evt = events.find(ev => String(ev.id) === String(id));
            openEventDetail(evt || {});
        }
    });

   // Right-click context menu for events
   const ctxMenu = document.getElementById('eventContextMenu');
   let ctxTargetEventId = null;
   grid.addEventListener('contextmenu', function(e) {
       const el = e.target.closest ? e.target.closest('.event-bar') : null;
       if (!el) return; // let browser default for non-events
       e.preventDefault();
       ctxTargetEventId = el.dataset.eventId;
       // Position menu at cursor with viewport constraints
       const menu = ctxMenu;
       const vw = window.innerWidth;
       const vh = window.innerHeight;
       menu.style.display = 'block';
       menu.classList.remove('hidden');
       const rect = menu.getBoundingClientRect();
       const left = Math.min(e.clientX, vw - rect.width - 8);
       const top = Math.min(e.clientY, vh - rect.height - 8) + window.scrollY;
       menu.style.left = left + 'px';
       menu.style.top = top + 'px';
   });

   // Hide context menu on click elsewhere or scroll/resize
   document.addEventListener('click', function(e) {
       if (!ctxMenu.classList.contains('hidden') && !ctxMenu.contains(e.target)) {
           ctxMenu.classList.add('hidden');
           ctxMenu.style.display = 'none';
       }
   });
   window.addEventListener('scroll', () => { ctxMenu.classList.add('hidden'); ctxMenu.style.display = 'none'; });
   window.addEventListener('resize', () => { ctxMenu.classList.add('hidden'); ctxMenu.style.display = 'none'; });

   // Context menu actions
   const ctxDelete = document.getElementById('ctxDelete');
   if (ctxDelete) ctxDelete.addEventListener('click', () => {
       if (!ctxTargetEventId) return;
       events = events.filter(ev => String(ev.id) !== String(ctxTargetEventId));
       localStorage.setItem('calendarEvents', JSON.stringify(events));
       renderEventsOnCalendar();
      renderMyEvents();
      // Also refresh day view if visible
      const dayContainer = document.getElementById('dayCalendarContainer');
      if (dayContainer && !dayContainer.classList.contains('hidden')) {
          renderDayView(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), parseInt(document.querySelector('button[onclick="toggleTimePicker()"]')?.textContent.match(/\b\d+\b/)?.[0] || '1')));
      }
       ctxMenu.classList.add('hidden');
       ctxMenu.style.display = 'none';
   });
   // Color choices (apply and persist with tooltip names)
   ctxMenu.querySelectorAll('[data-color-choice]').forEach(btn => {
       btn.addEventListener('click', () => {
           const color = btn.getAttribute('data-color-choice');
           const idx = events.findIndex(ev => String(ev.id) === String(ctxTargetEventId));
           if (idx !== -1) {
               events[idx].color = color;
               localStorage.setItem('calendarEvents', JSON.stringify(events));
               renderEventsOnCalendar();
              renderMyEvents();
           }
           ctxMenu.classList.add('hidden');
           ctxMenu.style.display = 'none';
       });
   });
 });
 
 // Toggle user settings panel
 function toggleUserSettings() {
     const userSettingsPanel = document.getElementById('userSettingsPanel');
     userSettingsPanel.classList.toggle('hidden');
 }
 
 // Toggle color picker
 function toggleColorPicker() {
     const colorPicker = document.getElementById('colorPicker');
     colorPicker.classList.toggle('hidden');
 }
 
 // Toggle notification dropdown
 function toggleNotificationDropdown() {
     const notificationDropdown = document.getElementById('notificationDropdown');
     notificationDropdown.classList.toggle('hidden');
 }
 
 // Select notification option
 function selectNotification(option) {
     // Replace "Add notification" text with the selected option
     const addNotificationElement = document.querySelector('div[onclick="toggleNotificationDropdown()"]');
     addNotificationElement.innerHTML = `
         ${option}
         
         <!-- Notification Dropdown -->
         <div id="notificationDropdown" class="hidden absolute bottom-6 left-0 bg-white border border-gray-200 rounded-lg shadow-lg z-20 min-w-48">
             <div class="py-2">
                 <div class="px-4 py-2 text-xs font-medium text-gray-500 border-b border-gray-100">When the event starts</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('5 minutes before')">5 minutes before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('10 minutes before')">10 minutes before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('15 minutes before')">15 minutes before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('30 minutes before')">30 minutes before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('1 hour before')">1 hour before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('1 day before')">1 day before</div>
                 <div class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" onclick="selectNotification('Custom...')">Custom...</div>
             </div>
         </div>
     `;
     
     // Close dropdown
     const notificationDropdown = document.getElementById('notificationDropdown');
     notificationDropdown.classList.add('hidden');
 }
 
 // Select color from picker
 function selectColor(colorName, element) {
     const colorButton = document.querySelector('button[onclick="toggleColorPicker()"]');
     const colorPicker = document.getElementById('colorPicker');
     
     // Remove previous checkmark
     const previousCheckmark = colorPicker.querySelector('.checkmark');
     if (previousCheckmark) {
         previousCheckmark.remove();
     }
     
     // Add checkmark to selected color
     const checkmark = document.createElement('div');
     checkmark.className = 'checkmark absolute top-0 left-0 w-full h-full flex items-center justify-center';
     checkmark.innerHTML = '<span class="material-symbols-outlined text-white text-xs">check</span>';
     element.appendChild(checkmark);
     
     // Update button color
     const colorMap = {
         'red': 'bg-red-500',
         'orange': 'bg-orange-500',
         'green': 'bg-green-400',
         'blue': 'bg-blue-400',
         'purple': 'bg-purple-400',
         'gray': 'bg-gray-400',
         'pink': 'bg-pink-300',
         'yellow': 'bg-yellow-400',
         'darkgreen': 'bg-green-600',
         'darkblue': 'bg-blue-600',
         'darkpurple': 'bg-purple-600',
         'transparent': 'bg-transparent border-2 border-gray-300'
     };
     
     // Remove all color classes and add new one
     colorButton.className = colorButton.className.replace(/bg-\w+-\d+|border-\d+/, '');
     colorButton.className += ` ${colorMap[colorName]}`;
     
     // Close color picker
     colorPicker.classList.add('hidden');
 }
 </script>
 
<script>
    (function() {
        try {
            var isLocal = location.hostname === '127.0.0.1' || location.hostname === 'localhost';
            if (isLocal && location.port !== '8000') {
                var target = location.protocol + '//' + 'localhost' + ':8000' + location.pathname + location.search + location.hash;
                location.replace(target);
            }
        } catch (e) { }
    })();

    // Load profile picture from localStorage if available
    document.addEventListener('DOMContentLoaded', function() {
        try {
            const profile = JSON.parse(localStorage.getItem('lilac_profile'));
            if (profile && profile.avatar) {
                const sidebarProfilePicture = document.querySelector('.sidebar-profile-picture');
                if (sidebarProfilePicture) {
                    sidebarProfilePicture.style.backgroundImage = `url('${profile.avatar}')`;
                }
                
                // Also update the profile name if available
                const profileName = document.querySelector('.sidebar-profile-info p');
                if (profileName && profile.name) {
                    profileName.textContent = profile.name;
                }
            }
        } catch (error) {
            console.log('No profile data found in localStorage');
        }
    });
</script>
</body></html>

